import{aR as S,C as y,w as P,r as w}from"./index-ce5e170b.js";import{u as A}from"./user-638b6ecb.js";const B=A(),R=S("cart",()=>{let n=y("".concat(B.userInfo.userId,"-cart"),new Map);P(()=>B.userInfo.userId,o=>{console.log("watch---"),n=y("".concat(o,"-cart"),new Map)});const a=(o,s,t)=>{const e=n.value.get(o);if(!e)t.cartCount=1,t.checked=!0,n.value.set(o,{shopName:s,goodsList:[t]});else{const c=e.goodsList.find(m=>m.goodsId===t.goodsId);c?(c.cartCount++,c.checked=!0):(t.cartCount=1,t.checked=!0,e.goodsList.push(t))}},d=(o,s)=>{const t=n.value.get(o);if(t){const e=t.goodsList.find(c=>c.goodsId===s);if(e&&(e.cartCount--,e.cartCount<=0)){const c=t.goodsList.findIndex(m=>m.goodsId===s);t.goodsList.splice(c,1),t.goodsList.length===0&&n.value.delete(o)}}},r=(o,s)=>{const t=n.value.get(o);if(t){const e=t.goodsList.find(c=>c.goodsId===s);return e?e.cartCount:0}else return 0},f=o=>n.value.get(o),g=(o,s)=>{const t=n.value.get(o).goodsList.find(e=>e.goodsId===s);t&&(t.checked?t.checked=!1:t.checked=!0)},h=o=>{const s=n.value.get(o);if(s){const t=s.goodsList;for(let e=0;e<t.length;e++)if(!t[e].checked)return!1;return!0}else return!1},C=o=>{const s=n.value.get(o);s&&s.goodsList.forEach(t=>{t.checked=!1})},L=o=>{const s=n.value.get(o);s&&s.goodsList.forEach(t=>{t.checked=!0})};return{cartList:n,pushProductToCart:a,removeProductFromCart:d,getGoodsCartCount:r,getCartListByShopId:f,toggleChecked:g,isAllChecked:h,toggleAllChecked:o=>{h(o)?C(o):L(o)},cartCountTotalByShopId:o=>{const s=n.value.get(o);return s?s.goodsList.reduce((t,e)=>t+e.cartCount,0):0},selectedCartCountByShopId:o=>{const s=n.value.get(o);return s?s.goodsList.reduce((t,e)=>e.checked?t+e.cartCount:t,0):0},getCartTotalPriceByShopId:o=>{let s=0,t=0;const e=n.value.get(o);return e&&e.goodsList.forEach(c=>{c.checked&&(t+=c.cartCount*c.oldPrice,c.cartCount>c.discount.limitCount?s+=c.discount.limitCount*c.oldPrice*c.discount.value*.1+(c.cartCount-c.discount.limitCount)*c.oldPrice:s+=c.cartCount*c.oldPrice*c.discount.value*.1)}),{nowPriceTotal:Number(s.toFixed(2)),oldPriceTotal:Number(t.toFixed(2))}},clearCartListByShopId:o=>{n.value.delete(o)},getAllCheckedGoodsListByShopId:o=>{const s=n.value.get(o);if(console.log("ssss"),s){const t=s.goodsList.filter(e=>e.checked);return{shopId:o,shopName:s.shopName,goodsList:t}}else return null},clearCartCheckedGoodsByShopId:o=>{const s=n.value.get(o);if(s){const t=s.goodsList.filter(e=>!e.checked);t.length<=0?n.value.delete(o):s.goodsList=t}},getCartList:()=>n,getAllCheckedGoodsPrice:()=>{let o=0,s=0;for(const{goodsList:t}of n.value.values())t.forEach(e=>{e.checked&&(s+=e.cartCount*e.oldPrice,e.cartCount>e.discount.limitCount?o+=e.discount.limitCount*e.oldPrice*e.discount.value*.1+(e.cartCount-e.discount.limitCount)*e.oldPrice:o+=e.cartCount*e.oldPrice*e.discount.value*.1)});return{nowPriceTotal:o,oldPriceTotal:s}},getAllCheckedGoodsList:()=>{const o=new Map;for(const[s,t]of n.value.entries()){const e=t.goodsList.filter(c=>c.checked);if(e.length>0){const c={...t};c.goodsList=e,o.set(s,c)}}return o},clearAllCheckedGoodsList:()=>{for(const[o,s]of n.value.entries()){const t=s.goodsList.filter(e=>!e.checked);t.length>0?(s.goodsList=t,n.value.set(o,s)):n.value.delete(o)}},deleteGoodsToCartById:(o,s)=>{const t=n.value.get(o);if(t){const e=t.goodsList.findIndex(c=>c.goodsId==s);e>=0&&(t.goodsList.splice(e,1),t.goodsList.length===0&&n.value.delete(o))}}}});function T(n){return{all:n=n||new Map,on:function(a,d){var r=n.get(a);r?r.push(d):n.set(a,[d])},off:function(a,d){var r=n.get(a);r&&(d?r.splice(r.indexOf(d)>>>0,1):n.set(a,[]))},emit:function(a,d){var r=n.get(a);r&&r.slice().map(function(f){f(d)}),(r=n.get("*"))&&r.slice().map(function(f){f(a,d)})}}}const E=T();function H(n=30,a=30){const r=(l=>{const i=w([]);for(let u=0;u<l;u++)i.value.push({isShow:!1,addCartEl:{}});return i})(10),f=[],g=l=>{const i=r.value.find(u=>!u.isShow);i&&(i.isShow=!0,i.addCartEl=l,f.push(i))},h=l=>{const u=f[f.length-1].addCartEl.getBoundingClientRect(),k=u.left-n,I=-(window.innerHeight-u.top-a);l.style.transform="translate(0,".concat(I,"px)");const p=l.getElementsByClassName("inner")[0];p&&(p.style.transform="translate(".concat(k,"px,0)"))},C=(l,i)=>{setTimeout(()=>{l.style.transform="translate(0,0)";const u=l.getElementsByClassName("inner")[0];u&&(u.style.transform="translate(0,0)")}),l.addEventListener("transitionend",i)},L=l=>{const i=f.shift();i&&(i.isShow=!1,l.style.display="none")};return E.on("add-cart",l=>{console.log("add-cart"),g(l)}),{start:g,onAfterEnter:L,onBeforeEnter:h,onEnter:C,balls:r}}export{H as a,E as e,R as u};
